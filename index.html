<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AI 手势粒子控制系统</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Segoe UI', sans-serif; }
        #container { width: 100vw; height: 100vh; }
        
        /* UI 叠加层 */
        .ui-panel {
            position: absolute; top: 20px; left: 20px;
            background: rgba(0, 0, 0, 0.7); padding: 20px;
            border-radius: 12px; border: 1px solid #d4af37;
            color: #d4af37; backdrop-filter: blur(10px);
            z-index: 100;
        }
        h2 { margin: 0 0 15px 0; font-size: 18px; text-transform: uppercase; letter-spacing: 2px; }
        .control-group { margin-bottom: 15px; }
        label { display: block; font-size: 12px; margin-bottom: 5px; color: #fff; }
        select, input { background: #1a1a1a; border: 1px solid #d4af37; color: #d4af37; padding: 5px; width: 100%; }
        
        /* 状态指示器 */
        #status { font-size: 12px; color: #00ff00; margin-top: 10px; }
        
        /* 隐藏原始视频预览 */
        #video-input { position: fixed; bottom: 10px; right: 10px; width: 160px; height: 120px; 
                       border: 1px solid #d4af37; border-radius: 8px; transform: scaleX(-1); }
    </style>
</head>
<body>

    <div class="ui-panel">
        <h2>粒子控制系统</h2>
        <div class="control-group">
            <label>粒子形状</label>
            <select id="shapeSelect">
                <option value="sphere">几何球体</option>
                <option value="heart">浪漫心形</option>
                <option value="firework">璀璨烟花</option>
            </select>
        </div>
        <div class="control-group">
            <label>粒子颜色</label>
            <input type="color" id="colorPicker" value="#d4af37">
        </div>
        <div id="status">正在初始化摄像头...</div>
        <div style="font-size: 10px; color: #888; margin-top: 10px;">
            提示：双手张开扩散，捏合收缩
        </div>
    </div>

    <video id="video-input"></video>
    <div id="container"></div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.152.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <script>
        let scene, camera, renderer, particles, particleSystem;
        const PARTICLE_COUNT = 15000;
        let targetPositions = [];
        let currentShape = 'sphere';
        let expansionFactor = 1.0;

        // 1. 初始化 Three.js 场景
        function initScene() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.getElementById('container').appendChild(renderer.domElement);

            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(PARTICLE_COUNT * 3);
            const colors = new Float32Array(PARTICLE_COUNT * 3);

            for (let i = 0; i < PARTICLE_COUNT; i++) {
                positions[i * 3] = (Math.random() - 0.5) * 10;
                positions[i * 3 + 1] = (Math.random() - 0.5) * 10;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 10;
            }

            geometry.setAttribute('position', new THREE.BufferAttribute(